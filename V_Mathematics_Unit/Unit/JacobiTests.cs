using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

using NUnit.Framework;
using NUnit.Framework.Constraints;
using Vulpine_Core_Calc_Tests.AddOns;

using Vulpine.Core.Calc;
using Vulpine.Core.Calc.Numbers;


namespace Vulpine_Core_Calc_Tests.Unit
{
    [TestFixture]
    class JacobiTests
    {
        /// <summary>
        /// the tollarance used in desk calculations. it represents the minimum
        /// amound of relative error allowed in numeric aproximations.
        /// </summary>
        public const Double VTOL = 1.0e-12;

        //stores a rerenece to the tolarance for this instance
        private double tol;

        public JacobiTests() { tol = VTOL; }
        public JacobiTests(double tol) { this.tol = tol; }


        #region K_WideValues...

        private static readonly double[][] K_WideValues =
        {
            new double[] {-4.0, -4.0, +0.9226456659702936, -0.1931692873996115},
            new double[] {-4.0, -3.0, +0.9547943021918690, -0.1578510441164987},
            new double[] {-4.0, -2.0, +0.9827836618197414, -0.1130037219922447},
            new double[] {-4.0, -1.0, +1.0023538882006214, -0.0592813395948073},
            new double[] {-4.0, +0.0, +1.0094529099892116, +0.0},
            new double[] {-4.0, +1.0, +1.0023538882006214, +0.0592813395948073},
            new double[] {-4.0, +2.0, +0.9827836618197414, +0.1130037219922447},
            new double[] {-4.0, +3.0, +0.9547943021918690, +0.1578510441164987},
            new double[] {-4.0, +4.0, +0.9226456659702936, +0.1931692873996115},

            new double[] {-3.0, -4.0, +0.9535789488040512, -0.2309304450374611},
            new double[] {-3.0, -3.0, +0.9966796083098644, -0.1941136432700918},
            new double[] {-3.0, -2.0, +1.0368869696797009, -0.1430138907757651},
            new double[] {-3.0, -1.0, +1.0669043258292005, -0.0767626332742274},
            new double[] {-3.0, +0.0, +1.0782578237498216, +0.0},
            new double[] {-3.0, +1.0, +1.0669043258292005, +0.0767626332742274},
            new double[] {-3.0, +2.0, +1.0368869696797009, +0.1430138907757651},
            new double[] {-3.0, +3.0, +0.9966796083098644, +0.1941136432700918},
            new double[] {-3.0, +4.0, +0.9535789488040512, +0.2309304450374611},

            new double[] {-2.0, -4.0, +0.9828072859190707, -0.2798612805636197},
            new double[] {-2.0, -3.0, +1.0408718798817036, -0.2449711163048068},
            new double[] {-2.0, -2.0, +1.1008325556573280, -0.1891623873371161},
            new double[] {-2.0, -1.0, +1.1508953676782991, -0.1059888365485736},
            new double[] {-2.0, +0.0, +1.1714200841467698, +0.0},
            new double[] {-2.0, +1.0, +1.1508953676782991, +0.1059888365485736},
            new double[] {-2.0, +2.0, +1.1008325556573280, +0.1891623873371161},
            new double[] {-2.0, +3.0, +1.0408718798817036, +0.2449711163048068},
            new double[] {-2.0, +4.0, +0.9828072859190707, +0.2798612805636197},

            new double[] {-1.0, -4.0, +1.0055145128822043, -0.3420446575053614},
            new double[] {-1.0, -3.0, +1.0818616094704879, -0.3166313240911675},
            new double[] {-1.0, -2.0, +1.1727767266293722, -0.2643613655297735},
            new double[] {-1.0, -1.0, +1.2654855220565945, -0.1622369065268035},
            new double[] {-1.0, +0.0, +1.3110287771460599, +0.0},
            new double[] {-1.0, +1.0, +1.2654855220565945, +0.1622369065268035},
            new double[] {-1.0, +2.0, +1.1727767266293722, +0.2643613655297735},
            new double[] {-1.0, +3.0, +1.0818616094704879, +0.3166313240911675},
            new double[] {-1.0, +4.0, +1.0055145128822043, +0.3420446575053614},

            new double[] {+0.0, -4.0, +1.0142199528916402, -0.4167613759836460},
            new double[] {+0.0, -3.0, +1.1066577086973747, -0.4131446756023009},
            new double[] {+0.0, -2.0, +1.2360754981828200, -0.3889182790156602},
            new double[] {+0.0, -1.0, +1.4212722810450360, -0.2953802842147768},
            new double[] {+0.0, +0.0, +1.5707963267948966, +0.0},
            new double[] {+0.0, +1.0, +1.4212722810450360, +0.2953802842147768},
            new double[] {+0.0, +2.0, +1.2360754981828200, +0.3889182790156602},
            new double[] {+0.0, +3.0, +1.1066577086973747, +0.4131446756023009},
            new double[] {+0.0, +4.0, +1.0142199528916402, +0.4167613759836460},

            new double[] {+1.0, -4.0, +1.0012902954809083, -0.4974791089591366},
            new double[] {+1.0, -3.0, +1.0962184367320241, -0.5261202157806421},
            new double[] {+1.0, -2.0, +1.2396974481062428, -0.5649930987575376},
            new double[] {+1.0, -1.0, +1.5092369540512728, -0.6251464152026968},
            //////////// {+1.0, +0.0, INF, INF},
            new double[] {+1.0, +1.0, +1.5092369540512728, +0.6251464152026968},
            new double[] {+1.0, +2.0, +1.2396974481062428, +0.5649930987575376},
            new double[] {+1.0, +3.0, +1.0962184367320241, +0.5261202157806421},
            new double[] {+1.0, +4.0, +1.0012902954809083, +0.4974791089591366},

            new double[] {+2.0, -4.0, +0.9647645498664313, -0.5724252293654310},
            new double[] {+2.0, -3.0, +1.0429132919285160, -0.6296824723086412},
            new double[] {+2.0, -2.0, +1.1477936578355437, -0.7231645198844604},
            new double[] {+2.0, -1.0, +1.2829845888842128, -0.9093670609379803},
            new double[] {+2.0, +0.0, +1.3110287771460599, -1.3110287771460599},
            new double[] {+2.0, +1.0, +1.2829845888842128, +0.9093670609379803},
            new double[] {+2.0, +2.0, +1.1477936578355437, +0.7231645198844604},
            new double[] {+2.0, +3.0, +1.0429132919285160, +0.6296824723086412},
            new double[] {+2.0, +4.0, +0.9647645498664313, +0.5724252293654310},

            new double[] {+3.0, -4.0, +0.9111955638049650, -0.6313342832413452},
            new double[] {+3.0, -3.0, +0.9633740558183941, -0.7017449794606113},
            new double[] {+3.0, -2.0, +1.0170435642865263, -0.8062531787336743},
            new double[] {+3.0, -1.0, +1.0495633400512788, -0.9647117763139704},
            new double[] {+3.0, +0.0, +1.0010773804561062, -1.1714200841467698},
            new double[] {+3.0, +1.0, +1.0495633400512788, +0.9647117763139704},
            new double[] {+3.0, +2.0, +1.0170435642865263, +0.8062531787336743},
            new double[] {+3.0, +3.0, +0.9633740558183941, +0.7017449794606113},
            new double[] {+3.0, +4.0, +0.9111955638049650, +0.6313342832413452},

            new double[] {+4.0, -4.0, +0.8507791690905825, -0.6710823994252824},
            new double[] {+4.0, -3.0, +0.8799482869097269, -0.7412691086931250},
            new double[] {+4.0, -2.0, +0.8997593611897471, -0.8338933759653302},
            new double[] {+4.0, -1.0, +0.8943644725836783, -0.9508137364393680},
            new double[] {+4.0, +0.0, +0.8428751774062980, -1.0782578237498216},
            new double[] {+4.0, +1.0, +0.8943644725836783, +0.9508137364393680},
            new double[] {+4.0, +2.0, +0.8997593611897471, +0.8338933759653302},
            new double[] {+4.0, +3.0, +0.8799482869097269, +0.7412691086931250},
            new double[] {+4.0, +4.0, +0.8507791690905825, +0.6710823994252824},

            
        };

        #endregion

        #region JacobiSN_Values

        private static readonly double[][] SN_Values =
        {
            //new double[] {-4.0, -4.0, +0.9226456659702936, -0.1931692873996115},

            new double[] {0.51884, 2.9696, 1.6163, -1.737,       0.5904042482562915,  0.2701969466834309},
            new double[] {-0.4642, -0.74241, -1.3325, -3.4424,  -0.2878703003953116, -0.4256243499287333},
            new double[] {-2.5054, 2.7322, -3.8454, 1.6401,     -0.0213547668028777, -0.0560940349261536},
            new double[] {1.9631, -1.3195, 2.0376, 1.6454,      -0.1060823285986597,  0.5110974998434139},
            new double[] {2.8114, 0.28341, 1.2377, 1.9352,      -0.7309803535881583,  0.5799089350790940},
            new double[] {-1.4041, -0.76869, -1.5667, 1.4645,   -0.9414428334320158,  0.5785800371789658},
            new double[] {1.0744, -3.2558, -1.3843, -3.4903,    -0.6134924965069380, -0.1613447992498137},
            new double[] {3.4318, 1.1273, 0.10878, 2.483,       -0.9798159856498453,  0.0217583199681255},
            new double[] {-0.74485, 3.9235, 5.8967, -1.4473,    -0.3950396809752283,  0.0348401420141661},
            new double[] {-0.77622, 1.4645, -1.4115, -1.8291,    1.7465488149816220, -0.6922330979801313},
            new double[] {0.59547, -1.8571, 1.1433, -0.23808,    1.3134846542097847,  0.8408291622505532},
            new double[] {-1.9063, 3.6193, -2.4291, 3.1871,     -0.0256153901102475,  0.5158796263870473},
            new double[] {3.392, -1.1276, -0.76138, -1.484,     -1.2530314781304371,  0.2964120659992171},
            new double[] {-0.59867, 4.6045, 0.32384, -3.2861,    0.7471247961010219,  1.2957290239053219},
            new double[] {-0.70697, -2.0975, 0.49047, -0.89166, -1.0520626397896832, -0.1434426475669969},
            new double[] {4.0216, -2.1948, -1.4138, 2.1493,     -0.0639004140111691, -0.8285134469129856},
            new double[] {-4.2277, -0.57131, -6.1252, -0.39165,  0.1116489360673780, -1.1491158557439022},

            new double[] {-2.8996, -1.7471, -5.0601, -3.4198,    0.4840985298394761, -0.4627236477701964},
            new double[] {-4.4041, -4.5996, -3.6429, 5.3908,    -0.7648080322751002,  0.3318109170945521},
            new double[] {4.5348, -0.25964, -5.0607, -3.4879,    1.7778888257532164,  1.1874188939977641},
            new double[] {1.6481, -2.4168, 1.4735, 0.098811,     0.8739940132627293, -0.0229546755138366},
            new double[] {-2.0521, 2.4866, 4.7311, 0.78705,      0.4967493472208149, -0.0791867442184052},
            new double[] {0.24539, 0.60909, 1.4718, -6.0134,     0.3912110813222166,  0.3448321714213219},
            new double[] {-5.1079, 3.0495, 0.28787, 2.1139,     -0.1339951269138146, -1.0871902928930668},
            new double[] {0.31233, 1.9319, 3.3495, -1.9423,      0.5818055467626294, -0.0360105824180628},
            new double[] {3.0464, -0.12475, 3.5226, -1.6294,    -1.2547811104550785, -0.5477403848054309},
            new double[] {-2.2325, -0.68617, 2.9313, 2.7124,     0.6718425509230812, -0.5343907369695872},
            new double[] {4.2929, -0.49552, 2.012, 0.4788,      -0.5996038315180190,  0.1749389633738669},
            new double[] {-0.21409, -2.0623, 1.7063, -1.0401,   -0.7499596348958714,  0.3372669239139732},
            new double[] {-0.98572, 0.61073, -2.4567, -0.35624, -1.8057132804447074,  0.5317490878705340},
            new double[] {1.8426, -2.3206, -6.4677, -0.3523,    -0.1157612645012850, -0.0883781166886617},
            new double[] {2.8252, -2.8581, -1.7934, 5.7711,     -0.8933807146836327, -0.0613321906468595},
            new double[] {-4.1129, -2.1153, -0.8806, 0.78175,   -0.3459898431007929, -1.0963368341344065},
            new double[] {-0.055792, -6.73, -1.1968, 2.3502,     1.3820929672929049, -0.7206525489280350},
            new double[] {0.060937, -3.8852, -1.0884, -5.7173,   0.6529163419619607,  0.0474782102664632},
            new double[] {1.5342, -0.82911, -4.6552, 4.4875,    -0.8140875719195246,  0.0408705184674200},
             
            new double[] {-0.51966, -2.3266, 1.1472, -1.578,    -0.9269262346469677, -0.0727650501428693},
            new double[] {5.5771, 0.34506, -0.8464, -0.96523,    0.3706760431164086,  0.7882994654237900},
            new double[] {0.40154, 0.73103, -0.80694, 0.1994,    0.4049531917876222,  0.7847347405661588},
            new double[] {-5.2011, -1.4554, -2.034, -1.5004,     0.1951357294250087,  0.2782936197075804},
            new double[] {-2.1682, -3.9813, -0.31167, 2.7602,    0.0888613789268869,  0.5151195629135316},
            new double[] {3.5843, -0.72041, -2.6838, 1.6356,     1.6329291635786901, -0.3755001087261202},
            new double[] {-1.7575, -2.5675, 1.5384, 1.597,      -0.8201508023141739,  0.1981083256018297},
            new double[] {2.8833, -1.6027, -1.1431, 5.7989,      0.5988958359957328,  0.2346800752340524},
            new double[] {2.2567, 4.867, 4.6112, -0.59431,      -0.7148263819422689,  0.0841352818012224},
            new double[] {1.8267, 2.1128, -2.4009, 2.4857,       0.3061639866889533,  0.2273668597844990},
            new double[] {2.4739, -3.9952, -0.28193, -1.5946,    0.8542439070247735,  1.2460337650315692},
            new double[] {-0.43909, -2.2546, -4.2305, -0.85033,  -0.0301003836022761,  0.5349828081676795},
            new double[] {-0.079954, 1.7509, -3.6207, 5.8094,    0.1711276771535256, -2.4324275446236865},
            new double[] {1.2571, 0.026338, -7.3444, -0.54917,   0.5617264971365928, -0.0852656599794157},
            new double[] {-0.15456, 0.96257, 2.9899, -2.4781,    0.7484771529453407,  3.8433109862647318},
            new double[] {1.4584, -1.2188, 0.24417, 1.6115,      0.2142840939164182, -0.6020602436539698},
            new double[] {-1.0022, 3.7168, -1.0247, 0.7984,      0.2522506095966247, -0.7938298980543172},
            new double[] {-1.8307, -3.7039, 4.4231, 1.2966,     -0.0508744659345719, -0.1788986617891857},
            new double[] {-0.50668, 1.7062, -2.2515, -1.407,     0.9483213098220693,  0.0870797001254079}, 

            //55
            
            new double[] {-0.2637, 1.0366, 0.0093098, -4.8988,   1.8972034737408889,  0.6461099844842149},
            new double[] {1.2958, -3.7231, 0.53017, 5.2956,      0.2432727047834525,  0.0315466579759659},
            new double[] {0.72934, -0.45221, -4.1923, -0.34821,  1.0208241642889220, -0.7754649743791535},
            new double[] {1.7486, 1.7223, 0.34313, -4.2138,     -0.3254175453409664, -0.3327369237149366},
            new double[] {1.9573, -3.9533, -0.95808, -2.9808,   -0.6300189400574857,  0.1777006003110236},
            new double[] {6.2371, -2.1177, 1.1477, 0.4725,      -0.4208534158726762,  0.5344122460752836},
            new double[] {1.6908, -1.821, -0.15396, -7.1828,     0.9499529979993903,  0.1640319321360216},
            new double[] {-2.0776, 0.012671, 4.2839, -1.5105,    0.5518641008898748, -0.1163864711407930},
            new double[] {8.1582, 0.43575, 8.0114, 3.1815,      -0.4623924243840385, -0.1115151433747305},
            new double[] {1.237, -0.12197, -3.6635, 3.9543,      1.2878364062468114,  0.7821429961197959},
            new double[] {-0.96443, -0.56857, 0.31232, -1.16,   -0.7597108010481192, -0.4214993674679742},
            new double[] {-0.60091, 6.5271, -1.319, -1.8344,    -0.8317561100031516,  0.9793938649081955},
            new double[] {-3.1134, -2.3986, -0.645, 3.7016,     -0.0527379994729049, -0.3520628632888526},
            new double[] {2.3259, 0.86088, -2.2341, -1.2529,    -0.2110869860547066, -0.5734656192766448},
            new double[] {2.7895, -4.0373, -2.0195, -3.0925,     0.0039127457157222, -0.2092329426573289},
            new double[] {0.085197, -0.34575, -1.9436, -2.0393,  0.0674095254857922, -0.3509642725376925},
            new double[] {0.10603, 4.3921, 0.84231, -0.70556,    1.1461987062242048,  0.4801439067111590},
            new double[] {-0.76931, -3.6252, 1.1142, 5.5632,     0.7459631188724139, -0.3592604363402452},
            new double[] {1.2792, -1.3633, -0.45378, 2.4106,    -0.1872307392960212, -0.2461983977335170},
            new double[] {0.66703, -3.9449, -2.6263, 1.668,      0.0356270806271835, -0.6625607153699960},
            new double[] {-1.5311, -2.3284, 0.35369, -0.2923,   -1.2232052660711278, -0.4238903714639346},

            new double[] {-0.26425, -2.7057, -0.66402, 2.007,    0.9866799874353029, -0.5113203298708776},
            new double[] {-1.6117, -1.6544, 2.4188, -3.0095,     0.7764679317379035,  0.6898189358708989},
            new double[] {2.0092, -3.3006, 0.6498, -3.8894,      0.4942975835396195,  0.4769319042496746},
            new double[] {-2.7114, 1.2708, -1.6939, -0.25168,   -0.1754451443272037, -0.8803173264431467},
            new double[] {3.9241, -0.056073, 2.6377, -3.6035,    0.4240815079702533,  0.2091610327585381},
            new double[] {-1.2392, -2.7944, -1.6822, -0.8531,    0.6496560195879301,  1.1094381863018067},
            new double[] {-0.77461, -5.1859, 0.70602, -0.47599, -1.0911165980851063, -0.1636715276055846},
            new double[] {-2.4444, -2.9592, -0.055552, 0.49778, -0.9412622059618866,  0.4526552861052635}, 
            new double[] {1.5054, 2.5217, -1.5462, -1.8433,     -0.3718932451931742, -0.8439041606785837},
            new double[] {3.6996, -3.2272, 0.38114, 5.0978,     -0.4607827591334515,  0.4312504234848461},
            new double[] {0.40129, -0.55535, 1.1017, 3.3922,     0.3987850450884624, -0.3574826523783546},
            new double[] {1.5426, 2.6467, 2.2014, 2.1921,        0.8788087293844185, -0.0800586758911246},
            new double[] {-0.46821, 0.64862, 2.24, 0.50043,     -0.6567693841693364,  0.4414540381927468},
            new double[] {-4.6262, 3.7656, -1.2415, -1.0497,    -0.1489934594737862, -1.2001269902015487},
            new double[] {3.8101, 0.58841, -3.5347, 0.5149,     -0.2576757435983988,  0.4765400956825414},
            new double[] {2.9978, 3.6309, 1.7695, -1.0864,      -0.6908604415031601, -0.1647036232278390},
            new double[] {0.11969, 0.92434, 1.8318, 4.601,      -1.3888232679296806,  1.2279301092504240},
            new double[] {-2.2738, -2.6237, -2.9983, 2.1055,    -0.1148525608541707, -2.4597653366721075},
            new double[] {2.7136, 1.5111, -1.3321, 1.671,        0.5903603182374138, -1.3944471387974824},
            new double[] {6.3199, -2.4098, -1.834, -0.28422,    -0.6995918558917249, -0.1575595227043095},
            new double[] {-1.1247, 6.2212, -2.2764, 1.8201,      0.9130032698194003, -0.6357778500271393},
            new double[] {3.1529, 1.3546, 3.4171, -1.5772,      -0.3103045807566037,  0.5781773299245945},
            new double[] {-0.35512, 3.332, 0.3064, -1.4655,      0.5778014278229897,  0.4394031108155883},

        };

        #endregion


        [Test]
        public void KTest_WideValues([Range(0, 79)] int index)
        {
            double[] vals = K_WideValues[index];
            Cmplx a = new Cmplx(vals[0], vals[1]);
            Cmplx b = new Cmplx(vals[2], vals[3]);

            Cmplx res = Jacobi.K(a);

            Assert.That(res, Ist.WithinTolOf(b, tol));
        }

        [Test]
        public void SN_Test_PreValues([Range(0, 98)] int index)
        {
            double[] vals = SN_Values[index];
            Cmplx a = new Cmplx(vals[0], vals[1]);
            Cmplx b = new Cmplx(vals[2], vals[3]);
            Cmplx c = new Cmplx(vals[4], vals[5]);

            Cmplx res = Jacobi.SN(a, b);

            Assert.That(res, Ist.WithinTolOf(c, tol));
        }
    }
}
